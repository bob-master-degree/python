{% extends "base.html" %}
{% block content %}
  <section class="relative overflow-hidden rounded-3xl border border-slate-200 bg-gradient-to-br from-white via-slate-50 to-white p-10 mb-8">
    <div class="relative z-10">
      <h1 class="text-4xl font-bold tracking-tight">Факт‑чекер текста</h1>
      <p class="mt-2 text-slate-700 max-w-2xl">Вставьте любой текст — мы выделим утверждения и оценим их достоверность.</p>
    </div>
    <div class="absolute -right-10 -top-10 h-48 w-48 rounded-full bg-primary-200 blur-3xl opacity-60"></div>
    <div class="absolute -left-10 -bottom-10 h-48 w-48 rounded-full bg-indigo-200 blur-3xl opacity-60"></div>
  </section>

  {% if not has_key %}
    <div class="mb-6 rounded-xl border border-amber-200 bg-amber-50 p-4 text-sm text-amber-800">
      Сначала сохраните ключ в "Настройках" — поля ввода временно недоступны.
    </div>
  {% endif %}

  <div class="flex flex-col lg:flex-row gap-8 items-stretch lg:items-start">
    <div class="flex-1 rounded-2xl shadow border border-slate-200 bg-white p-6 {% if not has_key %}opacity-70 pointer-events-none select-none{% endif %}">
      <div id="error-slot" class="hidden"></div>
      <form hx-post="/analyze" hx-target="#result" hx-swap="innerHTML" hx-indicator="#spinner" hx-disabled-elt="button" class="space-y-5"
            hx-on="htmx:beforeRequest: document.querySelector('#result').innerHTML=''; document.querySelector('#error-slot').classList.add('hidden'); this.querySelectorAll('textarea,button').forEach(el=>el.disabled=true); htmx:afterRequest: this.reset(); this.querySelectorAll('textarea,button').forEach(el=>el.disabled=false);"
            hx-on::after-request="if (event.detail.xhr.status>=400){ const toast = document.createElement('div'); toast.innerHTML = event.detail.xhr.response; document.body.appendChild(toast.firstElementChild); }">
        <div>
          <label class="block text-sm font-medium mb-2">Текст</label>
          <textarea name="text" rows="14" class="w-full rounded-xl px-3 py-3 bg-white text-slate-900 border border-slate-300 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent placeholder-slate-400" placeholder="Вставьте текст с предложениями..." required></textarea>
        </div>
        <div class="flex items-center gap-3 relative pr-28">
          <button type="submit" class="px-5 py-2.5 rounded-xl bg-primary-600 text-white hover:bg-primary-700 disabled:bg-primary-400 disabled:hover:bg-primary-400 disabled:opacity-60 disabled:cursor-not-allowed disabled:pointer-events-none">Проверить факты</button>
          <div id="spinner" class="htmx-indicator text-sm text-slate-600 flex items-center gap-2 absolute right-0 top-1/2 -translate-y-1/2">
            <svg class="animate-spin h-4 w-4 text-slate-500" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path></svg>
            Анализируем...
          </div>
        </div>
      </form>
    </div>

    <div id="result" class="flex-1 rounded-2xl shadow border border-slate-200 bg-white p-6 min-h-[240px]">
      <div class="text-slate-600">Результаты появятся здесь.</div>
    </div>
  </div>
{% endblock %}
